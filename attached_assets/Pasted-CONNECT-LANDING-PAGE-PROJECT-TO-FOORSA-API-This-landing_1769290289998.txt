CONNECT LANDING PAGE PROJECT TO FOORSA API

This landing page project needs to send tracking data to the main Foorsa website.

Foorsa API Base URL: https://foorsa-mehdi80.replit.app

==============================================================
PART 1: CREATE API CONFIG FILE
==============================================================

Create file: config.js

const CONFIG = {
    FOORSA_API_URL: 'https://foorsa-mehdi80.replit.app',
    
    // API Endpoints
    ENDPOINTS: {
        VALIDATE_INFLUENCER: '/api/influencer/validate/',
        TRACK_CLICK: '/api/influencer/track-click',
        TRACK_SUBMISSION: '/api/influencer/track-submission',
        INFLUENCER_LOGIN: '/api/influencer/login',
        INFLUENCER_STATS: '/api/influencer/stats/'
    }
};

// Make available globally
if (typeof window !== 'undefined') {
    window.FOORSA_CONFIG = CONFIG;
}

if (typeof module !== 'undefined') {
    module.exports = CONFIG;
}

==============================================================
PART 2: CREATE TRACKING SCRIPT
==============================================================

Create file: tracking.js

/**
 * Foorsa Influencer Tracking Script
 * Tracks clicks and submissions for influencer landing pages
 */

const FoorsaTracking = {
    apiUrl: 'https://foorsa-mehdi80.replit.app',
    influencerCode: null,
    
    /**
     * Initialize tracking - call this on page load
     */
    init: function() {
        // Get influencer code from URL path (/lp/CODE) or query param (?ref=CODE)
        const pathMatch = window.location.pathname.match(/\/lp\/([^\/]+)/i);
        const urlParams = new URLSearchParams(window.location.search);
        
        this.influencerCode = pathMatch ? pathMatch[1].toUpperCase() : urlParams.get('ref')?.toUpperCase();
        
        if (this.influencerCode) {
            // Store in sessionStorage for form submissions
            sessionStorage.setItem('influencer_code', this.influencerCode);
            
            // Validate and track click
            this.validateAndTrackClick();
        }
        
        return this;
    },
    
    /**
     * Validate influencer code and track the click
     */
    validateAndTrackClick: async function() {
        if (!this.influencerCode) return;
        
        try {
            // First validate the influencer exists
            const validateRes = await fetch(`${this.apiUrl}/api/influencer/validate/${this.influencerCode}`);
            const validateData = await validateRes.json();
            
            if (!validateData.valid) {
                console.warn('Invalid influencer code:', this.influencerCode);
                return;
            }
            
            // Track the click
            await fetch(`${this.apiUrl}/api/influencer/track-click`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    code: this.influencerCode,
                    page_url: window.location.href,
                    referrer: document.referrer,
                    user_agent: navigator.userAgent,
                    timestamp: new Date().toISOString()
                })
            });
            
            console.log('Click tracked for influencer:', this.influencerCode);
            
            // Optionally personalize the page
            if (validateData.influencer) {
                this.personalizePage(validateData.influencer);
            }
            
        } catch (err) {
            console.error('Tracking error:', err);
        }
    },
    
    /**
     * Personalize the page with influencer info (optional)
     */
    personalizePage: function(influencer) {
        // Update any elements with data-influencer-name attribute
        document.querySelectorAll('[data-influencer-name]').forEach(el => {
            el.textContent = influencer.name;
        });
        
        // Update influencer image if exists
        if (influencer.profile_image) {
            document.querySelectorAll('[data-influencer-image]').forEach(el => {
                el.src = influencer.profile_image;
            });
        }
    },
    
    /**
     * Track form submission - call this when form is submitted
     */
    trackSubmission: async function(formData) {
        const code = this.influencerCode || sessionStorage.getItem('influencer_code');
        
        if (!code) {
            console.warn('No influencer code found for submission tracking');
            return { success: false };
        }
        
        try {
            const response = await fetch(`${this.apiUrl}/api/influencer/track-submission`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    influencer_code: code,
                    name: formData.name || '',
                    email: formData.email || '',
                    phone: formData.phone || '',
                    program_type: formData.program_type || '',
                    source: 'landing_page',
                    page_url: window.location.href,
                    timestamp: new Date().toISOString()
                })
            });
            
            const result = await response.json();
            console.log('Submission tracked:', result);
            return result;
            
        } catch (err) {
            console.error('Submission tracking error:', err);
            return { success: false, error: err.message };
        }
    },
    
    /**
     * Get current influencer code
     */
    getInfluencerCode: function() {
        return this.influencerCode || sessionStorage.getItem('influencer_code');
    }
};

// Auto-initialize when script loads
document.addEventListener('DOMContentLoaded', function() {
    FoorsaTracking.init();
});

// Make available globally
window.FoorsaTracking = FoorsaTracking;

==============================================================
PART 3: UPDATE LANDING PAGE HTML
==============================================================

In your landing page HTML files, add the tracking script:

In <head> or before </body>:
<script src="/tracking.js"></script>

Update your form submission to track with Foorsa:

<script>
document.getElementById('landing-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = {
        name: document.getElementById('name').value,
        email: document.getElementById('email').value,
        phone: document.getElementById('phone').value,
        program_type: document.getElementById('program_type')?.value || 'language_bachelor'
    };
    
    // Track submission with Foorsa
    await FoorsaTracking.trackSubmission(formData);
    
    // Continue with your normal form submission logic
    // e.g., show thank you message, redirect, etc.
    
    // Show success message
    document.getElementById('form-container').innerHTML = `
        <div class="success-message">
            <h2>Thank you!</h2>
            <p>We'll contact you within 24 hours.</p>
        </div>
    `;
});
</script>

==============================================================
PART 4: CREATE INFLUENCER DASHBOARD PAGE
==============================================================

Create file: influencer-dashboard.html

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Influencer Dashboard - Foorsa</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #041228;
            --bg-secondary: #0a2540;
            --bg-card: #1a1a2e;
            --accent-gold: #C9A84C;
            --success: #4CAF50;
            --error: #ff6b6b;
            --text-primary: #ffffff;
            --text-muted: #8a9ab0;
            --border: #333333;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'DM Sans', sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; }
        
        .container { max-width: 1000px; margin: 0 auto; padding: 30px 20px; }
        
        /* Login Form */
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: var(--bg-card);
            border-radius: 16px;
            padding: 40px;
            text-align: center;
        }
        
        .login-container h1 {
            color: var(--accent-gold);
            margin-bottom: 10px;
        }
        
        .login-container p {
            color: var(--text-muted);
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            color: var(--text-muted);
            font-size: 13px;
            margin-bottom: 8px;
        }
        
        .form-group input {
            width: 100%;
            padding: 14px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 15px;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: var(--accent-gold);
        }
        
        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--accent-gold) 0%, #E5C76B 100%);
            color: var(--bg-primary);
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .error-message {
            background: rgba(255, 107, 107, 0.1);
            color: var(--error);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        
        /* Dashboard */
        .dashboard { display: none; }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .dashboard-header h1 {
            color: var(--accent-gold);
        }
        
        .logout-btn {
            background: var(--bg-card);
            color: var(--text-muted);
            border: 1px solid var(--border);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
        }
        
        .stat-card h3 {
            color: var(--text-muted);
            font-size: 13px;
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        
        .stat-card .value {
            font-size: 36px;
            font-weight: 700;
            color: var(--accent-gold);
        }
        
        .link-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .link-section h2 {
            color: var(--text-primary);
            font-size: 18px;
            margin-bottom: 15px;
        }
        
        .link-box {
            display: flex;
            gap: 10px;
        }
        
        .link-box input {
            flex: 1;
            padding: 14px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--accent-gold);
            font-family: monospace;
            font-size: 14px;
        }
        
        .link-box button {
            padding: 14px 24px;
            background: var(--accent-gold);
            color: var(--bg-primary);
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .recent-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 25px;
        }
        
        .recent-section h2 {
            color: var(--text-primary);
            font-size: 18px;
            margin-bottom: 20px;
        }
        
        .recent-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .recent-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
            font-size: 14px;
        }
        
        .recent-item:last-child {
            border-bottom: none;
        }
        
        .recent-item .type {
            color: var(--accent-gold);
            font-weight: 600;
        }
        
        .recent-item .time {
            color: var(--text-muted);
        }
        
        .empty-state {
            text-align: center;
            padding: 30px;
            color: var(--text-muted);
        }
    </style>
</head>
<body>
    <!-- Login Form -->
    <div class="login-container" id="login-section">
        <h1>Influencer Dashboard</h1>
        <p>Login to view your performance stats</p>
        
        <div class="error-message" id="login-error"></div>
        
        <form id="login-form">
            <div class="form-group">
                <label>Your Code</label>
                <input type="text" id="login-code" placeholder="e.g., HADIL" required style="text-transform: uppercase;">
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="login-password" placeholder="Enter your password" required>
            </div>
            <button type="submit" class="btn">Login</button>
        </form>
    </div>
    
    <!-- Dashboard -->
    <div class="dashboard" id="dashboard-section">
        <div class="container">
            <div class="dashboard-header">
                <div>
                    <h1>Welcome, <span id="influencer-name">Influencer</span>!</h1>
                    <p style="color: var(--text-muted);">Here's your performance overview</p>
                </div>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Clicks</h3>
                    <div class="value" id="stat-clicks">0</div>
                </div>
                <div class="stat-card">
                    <h3>Total Leads</h3>
                    <div class="value" id="stat-leads">0</div>
                </div>
                <div class="stat-card">
                    <h3>Conversion Rate</h3>
                    <div class="value" id="stat-conversion">0%</div>
                </div>
                <div class="stat-card">
                    <h3>Earnings</h3>
                    <div class="value" id="stat-earnings">$0</div>
                </div>
            </div>
            
            <div class="link-section">
                <h2>Your Landing Page Link</h2>
                <p style="color: var(--text-muted); margin-bottom: 15px;">Share this link with your audience</p>
                <div class="link-box">
                    <input type="text" id="my-link" readonly>
                    <button onclick="copyMyLink()">Copy Link</button>
                </div>
            </div>
            
            <div class="recent-section">
                <h2>Recent Activity</h2>
                <div class="recent-list" id="recent-activity">
                    <div class="empty-state">Loading...</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const FOORSA_API = 'https://foorsa-mehdi80.replit.app';
        const LANDING_BASE = window.location.origin;
        
        let currentInfluencer = null;
        
        // Check if already logged in
        document.addEventListener('DOMContentLoaded', function() {
            const savedCode = localStorage.getItem('influencer_code');
            if (savedCode) {
                loadDashboard(savedCode);
            }
        });
        
        // Login form
        document.getElementById('login-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const code = document.getElementById('login-code').value.toUpperCase();
            const password = document.getElementById('login-password').value;
            const errorEl = document.getElementById('login-error');
            
            try {
                const response = await fetch(`${FOORSA_API}/api/influencer/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code, password })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    localStorage.setItem('influencer_code', code);
                    localStorage.setItem('influencer_token', result.token);
                    loadDashboard(code);
                } else {
                    errorEl.textContent = result.error || 'Login failed';
                    errorEl.style.display = 'block';
                }
            } catch (err) {
                errorEl.textContent = 'Connection error. Please try again.';
                errorEl.style.display = 'block';
            }
        });
        
        async function loadDashboard(code) {
            try {
                const response = await fetch(`${FOORSA_API}/api/influencer/stats/${code}`);
                const data = await response.json();
                
                if (data.error) {
                    logout();
                    return;
                }
                
                currentInfluencer = data.influencer;
                
                // Update UI
                document.getElementById('login-section').style.display = 'none';
                document.getElementById('dashboard-section').style.display = 'block';
                
                document.getElementById('influencer-name').textContent = data.influencer.name;
                
                const stats = data.influencer.stats || {};
                document.getElementById('stat-clicks').textContent = stats.total_clicks || 0;
                document.getElementById('stat-leads').textContent = stats.total_submissions || 0;
                
                const clicks = stats.total_clicks || 0;
                const leads = stats.total_submissions || 0;
                const conversion = clicks > 0 ? ((leads / clicks) * 100).toFixed(1) : 0;
                document.getElementById('stat-conversion').textContent = conversion + '%';
                
                const earnings = stats.total_earnings || 0;
                document.getElementById('stat-earnings').textContent = '$' + earnings;
                
                // Set link
                document.getElementById('my-link').value = `${LANDING_BASE}/lp/${code.toLowerCase()}`;
                
                // Recent activity
                renderRecentActivity(data.recent_clicks || [], data.recent_submissions || []);
                
            } catch (err) {
                console.error('Error loading dashboard:', err);
                logout();
            }
        }
        
        function renderRecentActivity(clicks, submissions) {
            const container = document.getElementById('recent-activity');
            
            // Combine and sort by time
            const activities = [
                ...clicks.map(c => ({ type: 'Click', time: c.timestamp })),
                ...submissions.map(s => ({ type: 'Lead', time: s.timestamp, name: s.name }))
            ].sort((a, b) => new Date(b.time) - new Date(a.time)).slice(0, 20);
            
            if (activities.length === 0) {
                container.innerHTML = '<div class="empty-state">No activity yet. Share your link to get started!</div>';
                return;
            }
            
            container.innerHTML = activities.map(a => `
                <div class="recent-item">
                    <span class="type">${a.type}${a.name ? ': ' + a.name : ''}</span>
                    <span class="time">${formatTime(a.time)}</span>
                </div>
            `).join('');
        }
        
        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'Just now';
            if (diff < 3600000) return Math.floor(diff / 60000) + 'm ago';
            if (diff < 86400000) return Math.floor(diff / 3600000) + 'h ago';
            return date.toLocaleDateString();
        }
        
        function copyMyLink() {
            const input = document.getElementById('my-link');
            input.select();
            document.execCommand('copy');
            alert('Link copied!');
        }
        
        function logout() {
            localStorage.removeItem('influencer_code');
            localStorage.removeItem('influencer_token');
            document.getElementById('login-section').style.display = 'block';
            document.getElementById('dashboard-section').style.display = 'none';
            document.getElementById('login-code').value = '';
            document.getElementById('login-password').value = '';
        }
    </script>
</body>
</html>

==============================================================
PART 5: UPDATE YOUR LANDING PAGE ROUTES
==============================================================

If using Flask/Python for the landing page, update your app.py:

from flask import Flask, render_template, redirect

app = Flask(__name__)

@app.route('/lp/<influencer_code>')
def landing_page(influencer_code):
    """Serve landing page for specific influencer"""
    # The tracking.js will handle click tracking automatically
    return render_template('landing.html', influencer_code=influencer_code.upper())

@app.route('/influencer-dashboard')
def influencer_dashboard():
    """Serve influencer dashboard"""
    return send_file('influencer-dashboard.html')

If using static HTML, create a folder structure:
/lp/
    hadil/index.html
    hamza/index.html
    etc...

Or use JavaScript routing to handle /lp/CODE paths.

==============================================================
PART 6: TEST THE INTEGRATION
==============================================================

1. Create a test influencer in Foorsa admin (/admin/influencers.html)
   - Name: Test Influencer
   - Code: TEST
   - Password: test123

2. Visit your landing page: /lp/test
   - Check browser console for "Click tracked for influencer: TEST"

3. Submit a test form on the landing page
   - Check Foorsa admin to see the submission

4. Login to influencer dashboard: /influencer-dashboard
   - Code: TEST
   - Password: test123
   - Verify stats show the click and submission

==============================================================
CONFIRMATION
==============================================================

After completing:
1. Show me the tracking.js is working (check browser console)
2. Confirm clicks are appearing in Foorsa admin
3. Confirm influencer dashboard login works
